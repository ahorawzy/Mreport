---
title: "20180920_货运计算1"
author: "wzy"
date: "2018年9月20日"
output: html_document
---

```{r echo=FALSE}
knitr::opts_chunk$set(echo = F,message = F,warning = F)
```

```{r}
options(stringsAsFactors = F)
options(digits = 3)
rm(list = ls())
source("D:\\R\\packages\\Mreport\\scripts\\caculate.R", encoding = "utf-8")
source("D:\\R\\packages\\Mreport\\scripts\\select.R", encoding = "utf-8")
source("D:\\R\\packages\\Mreport\\scripts\\split.R", encoding = "utf-8")
```

```{r}
library(Mreport)
library(plyr)
library(ggplot2)
library(reshape2)
library(knitr)
library(leaflet)
library(leafletCN)
```

```{r}
load_base()
load_sample_base()
```

## 1. 核心城市

### 总行驶量

```{r}
jdcity <- read.csv("D:\\data\\sx_raw\\交调数据\\jdcity.csv",stringsAsFactors = F)
```

```{r}
jdcitys <- handle_gather_forym(jdcity)
```

```{r}
jdcitys <- jdcitys[jdcitys$ym != "2018-09月",]
```


```{r}
x <- caculate_frecarsmean(jdcitys,c("ym","province","level")) %>% dcast(ym+province~level)
x <- x[,c(1,2,3,4,6,5)]
head(x,10)
```

```{r}
x2 <- caculate_travel_volume(x,mileage,"province")
x2$武汉市 <- x2$湖北省/7
x2$湖北省 <- NULL
x2
```

```{r}
write.csv(x2,file = "D:\\交大云同步\\实习\\19_货运分析\\计算结果\\三市月平均日总行驶量.csv")
```

### 货车出行量

```{r}
x3 <- caculate_freight_trip(x,mileage,"province")
x3
```

```{r}
write.csv(x3,file = "D:\\交大云同步\\实习\\19_货运分析\\计算结果\\三市月平均日货车出行次数.csv")
```


## 3. 东中西三部分

```{r}
jdprovince <- read.csv("D:\\data\\sx_raw\\交调数据\\jdprovince.csv",stringsAsFactors = F)
dim(jdprovince)
```

```{r}
jdprovinces <- handle_gather_forym(jdprovince)
```


```{r}
jdprovinces <- jdprovinces[jdprovinces$ym != "2018-09月",]
```

```{r}
x <- caculate_frecarsmean(jdprovinces,c("ym","province","level")) %>% dcast(ym+province~level)
x <- x[,c(1,2,3,4,6,5)]
head(x,10)
```

```{r}
x2 <- caculate_travel_volume(x,mileage,"province")
x2
```


